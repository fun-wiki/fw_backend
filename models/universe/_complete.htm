<?
$complete = 0;
$num_fields = 0;


$fields = $vars['record']->attributes;

// dump($vars['record']->persons->toArray());

foreach ($fields as $key => $value) {
    if ($key === "id") {
        continue;
    }

    if ($key === "name") {
        continue;
    }

    if ($key === "created_at") {
        continue;
    }

    if ($key === "updated_at") {
        continue;
    }

    if ($key === "complete") {
        continue;
    }

    if ($value != null or $value != '') {
        $complete = $complete + 1;
    }
    $num_fields++;
}

if ($vars['record']->persons->toArray() != [] or $vars['record']->organisations->toArray() != []) {
    $complete++;
}

if ($vars['record']->genres->toArray() != []) {
    $complete++;
}



$result = ceil($complete/($num_fields+2)*100);

\fw\Backend\Models\Universe::where('id', $vars['record']->id)
    ->update(['complete' => $result])
?>

<? echo $result; ?>%
